# 矢量图导入性能优化使用指南

## 问题描述

当导入包含大量点数的矢量图（如复杂的SVG、DXF、PLT文件）时，可能会出现以下问题：
- 导入过程中界面卡死
- 浏览器无响应
- 内存占用过高
- 渲染性能下降

## 解决方案

### 1. 立即解决方案 - 使用高性能模式

**操作步骤：**
1. 点击工具栏中的"性能"按钮
2. 选择"高性能"预设配置
3. 点击"保存"应用设置
4. 重新导入矢量文件

**高性能模式参数：**
- 每个路径最大点数：200
- 路径简化容差：3.0
- 批处理大小：25
- 启用LOD：是
- 总点数限制：2000

### 2. 渐进式优化策略

#### 阶段1：导入阶段
- 使用"高性能"模式导入大型文件
- 观察导入进度，确保界面保持响应
- 如果仍然卡顿，可以进一步降低参数

#### 阶段2：编辑阶段
- 导入完成后，切换到"平衡"模式
- 进行必要的编辑和调整
- 利用LOD系统在缩放时自动优化显示

#### 阶段3：输出阶段
- 最终输出时可切换到"高质量"模式
- 获得最佳的细节表现
- 生成高精度的G代码

### 3. 自定义性能参数

#### 每个路径最大点数 (50-2000)
- **作用**：限制单个路径的采样点数
- **建议**：
  - 大文件：100-200
  - 中等文件：300-500
  - 小文件：500-1000

#### 路径简化容差 (0.5-5.0)
- **作用**：控制路径简化的程度，值越大简化越多
- **建议**：
  - 高精度需求：0.5-1.0
  - 平衡使用：1.5-2.5
  - 性能优先：3.0-5.0

#### 批处理大小 (10-200)
- **作用**：控制分帧处理的批次大小
- **建议**：
  - 低配设备：10-25
  - 中配设备：25-50
  - 高配设备：50-100

#### 总点数限制 (1000-20000)
- **作用**：限制整个项目的总点数
- **建议**：
  - 移动设备：1000-3000
  - 普通电脑：3000-8000
  - 高性能电脑：8000-15000

### 4. 性能监控使用

#### 查看实时性能
1. 点击右上角的"性能监控"按钮
2. 观察以下指标：
   - 对象数量
   - 总点数
   - 渲染时间
   - FPS（帧率）
   - 内存使用

#### 性能建议
- **绿色**（总点数 < 5000）：性能良好
- **黄色**（5000 < 总点数 < 10000）：需要注意
- **红色**（总点数 > 10000）：建议优化

### 5. 导入进度监控

#### 新增功能
- 实时显示导入进度
- 显示当前处理状态
- 提供性能优化建议
- 支持取消导入操作

#### 使用方法
1. 导入矢量文件时会自动显示进度窗口
2. 观察进度条和状态信息
3. 如果进度长时间停滞，可以取消后调整性能参数

### 6. 针对不同文件类型的建议

#### SVG文件
- 通常包含复杂路径和曲线
- 建议使用中等到高性能设置
- 特别注意路径简化容差设置

#### DXF文件
- 工程图文件，精度要求高
- 建议使用平衡到高质量设置
- 可以适当提高点数限制

#### PLT文件
- 绘图仪文件，通常较简单
- 可以使用较高质量设置
- 注意批处理大小的调整

### 7. 故障排除

#### 导入仍然卡死
1. 降低所有参数到最低值
2. 检查文件大小和复杂度
3. 考虑预处理文件（简化路径）
4. 分段导入大文件

#### 精度不够
1. 逐步提高最大点数
2. 降低简化容差
3. 启用高质量模式
4. 检查LOD设置

#### 内存不足
1. 降低总点数限制
2. 减少批处理大小
3. 关闭不必要的功能
4. 重启浏览器清理内存

### 8. 最佳实践

#### 文件预处理
- 在外部软件中预先简化复杂路径
- 删除不必要的细节和隐藏元素
- 合并相似的路径

#### 工作流程
1. 先用高性能模式导入
2. 检查导入结果
3. 根据需要调整到平衡模式
4. 最终输出时使用高质量模式

#### 设备适配
- **移动设备**：优先使用高性能模式
- **普通电脑**：使用平衡模式为主
- **高性能工作站**：可以使用高质量模式

## 技术原理

### 自适应采样
- 根据路径曲率动态调整采样密度
- 直线段使用较少采样点
- 曲线段增加采样点保持精度

### 道格拉斯-普克算法
- 递归简化路径，保持形状特征
- 可配置容差控制简化程度
- 大幅减少点数同时保持视觉效果

### 分帧处理
- 使用 requestAnimationFrame 避免阻塞UI
- 批处理控制每帧处理量
- 实时显示进度和状态

### 细节层次 (LOD)
- 根据缩放级别动态调整显示精度
- 缩小时自动简化显示
- 放大时恢复完整细节

## 更新日志

### v1.0.0 (当前版本)
- ✅ 自适应路径采样
- ✅ 道格拉斯-普克路径简化
- ✅ 性能配置系统
- ✅ 实时性能监控
- ✅ 分帧处理
- ✅ 导入进度显示
- ✅ LOD渲染优化
- ✅ 总点数限制

### 计划中的改进
- 🔄 Web Worker 后台处理
- 🔄 更智能的采样算法
- 🔄 内存池管理
- 🔄 GPU加速渲染

## 联系支持

如果在使用过程中遇到问题，请：
1. 首先尝试调整性能参数
2. 查看性能监控指标
3. 参考故障排除部分
4. 记录具体的文件类型和大小信息 