# 扫描图层参数配置说明

## 概述

本次更新为扫描图层添加了三个重要的G代码生成参数：功率最大值、功率最小值和移动速度。这些参数允许用户精确控制激光雕刻的功率范围和速度，以获得最佳的雕刻效果。

## 新增参数

### 1. 功率最大值 (maxPower)
- **范围**: 0-100 (%)
- **默认值**: 100
- **作用**: 控制扫描时的最大激光功率
- **影响**: 决定最深色区域的雕刻深度和强度

### 2. 功率最小值 (minPower)
- **范围**: 0-100 (%)
- **默认值**: 0
- **作用**: 控制扫描时的最小激光功率
- **影响**: 决定最浅色区域的雕刻深度，0表示完全不雕刻

### 3. 移动速度 (moveSpeed)
- **范围**: 100-10000 (mm/min)
- **默认值**: 3000
- **作用**: 控制激光头的移动速度
- **影响**: 影响雕刻效率和质量，速度越慢质量越好但耗时越长

## 参数配置位置

### 1. 图层创建时配置
在创建新的扫描图层时，可以在创建对话框中设置这些参数：
- 选择"扫描图层"类型
- 在扫描参数区域设置功率最大值、功率最小值和移动速度
- 点击确认创建图层

### 2. 图层设置面板配置
对于已存在的扫描图层，可以通过图层设置面板修改参数：
- 选择要编辑的扫描图层
- 在图层设置面板中找到新增的参数配置区域
- 实时调整参数值，修改会立即保存

## 参数预设建议

### 高质量预设
```
功率最大值: 95%
功率最小值: 5%
移动速度: 1500 mm/min
线密度: 20 线/毫米
```
**适用场景**: 精细雕刻、高质量要求的作品
**特点**: 雕刻质量最佳，但耗时较长

### 平衡预设 (默认)
```
功率最大值: 100%
功率最小值: 0%
移动速度: 3000 mm/min
线密度: 10 线/毫米
```
**适用场景**: 日常使用，质量与速度平衡
**特点**: 兼顾质量和效率

### 高速预设
```
功率最大值: 100%
功率最小值: 10%
移动速度: 6000 mm/min
线密度: 5 线/毫米
```
**适用场景**: 快速雕刻、效率优先
**特点**: 雕刻速度最快，质量略有降低

## G代码生成影响

这些参数直接影响生成的G代码：

### 功率控制
```gcode
; 使用功率范围 [minPower, maxPower]
G1 X10 S{maxPower} F{moveSpeed}  ; 深色区域使用最大功率
G1 X20 S{minPower} F{moveSpeed}  ; 浅色区域使用最小功率
```

### 速度控制
```gcode
; 燃烧速度使用 moveSpeed
G1 X10 S50 F{moveSpeed}          ; 雕刻移动
; 空程速度使用 moveSpeed * 2
G0 X0 Y10 F{moveSpeed * 2}       ; 快速移动
```

## 参数优化建议

### 材料相关
- **木材**: 功率80-100%，速度2000-4000 mm/min
- **亚克力**: 功率60-90%，速度1500-3000 mm/min
- **皮革**: 功率40-80%，速度2000-5000 mm/min
- **纸张**: 功率20-60%，速度3000-6000 mm/min

### 质量要求
- **高精度**: 降低速度，提高线密度，使用较小的功率范围
- **高效率**: 提高速度，降低线密度，使用较大的功率范围
- **深雕刻**: 提高最大功率，降低速度
- **浅雕刻**: 降低功率范围，可以提高速度

### 设备性能
- **高性能设备**: 可以使用更高的速度和功率
- **入门级设备**: 建议使用较保守的参数设置
- **老旧设备**: 降低速度和功率以确保稳定性

## 参数验证规则

系统会自动验证参数的合理性：

### 错误检查
- 功率最小值不能大于或等于功率最大值
- 功率值必须在0-100范围内
- 移动速度必须在100-10000范围内

### 警告提示
- 移动速度过低(<100)或过高(>8000)
- 线密度过高(>50)或过低(<2)
- 高速度配合高线密度可能影响质量

## 使用技巧

### 1. 渐进式调整
- 从默认参数开始
- 根据实际效果逐步调整
- 记录最佳参数组合

### 2. 测试样本
- 使用小块材料进行参数测试
- 制作参数对比样本
- 建立材料参数库

### 3. 批量处理
- 相同材料使用相同参数
- 创建参数模板
- 保存常用配置

## 故障排除

### 雕刻过深
- 降低功率最大值
- 提高移动速度
- 降低线密度

### 雕刻过浅
- 提高功率最大值
- 降低移动速度
- 提高线密度

### 质量不均匀
- 检查功率范围设置
- 调整移动速度
- 确保设备稳定性

### 效率低下
- 提高移动速度
- 降低线密度
- 优化功率设置

## 技术实现

### 数据结构
```typescript
interface Layer {
  // 新增字段
  maxPower?: number;        // 功率最大值 (0-100)
  minPower?: number;        // 功率最小值 (0-100)
  moveSpeed?: number;       // 移动速度 (mm/min)
  // 现有字段...
}
```

### G代码映射
```typescript
const settings: GCodeScanSettings = {
  minPower: layer.minPower ?? 0,
  maxPower: layer.maxPower ?? 100,
  burnSpeed: layer.moveSpeed ?? 3000,
  travelSpeed: (layer.moveSpeed ?? 3000) * 2,
  // 其他设置...
};
```

## 版本兼容性

- **向后兼容**: 现有图层会使用默认值
- **数据迁移**: 自动为现有扫描图层添加默认参数
- **配置保存**: 新参数会保存在图层配置中

## 测试验证

使用 `test-scan-parameters.html` 文件可以：
- 测试不同参数组合
- 预览生成的G代码
- 验证参数合理性
- 比较预设配置效果
