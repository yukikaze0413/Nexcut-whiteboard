# 矢量图导入性能优化

## 概述

本项目针对矢量图导入时的性能问题进行了全面优化，特别是当矢量图包含大量点数时的卡顿问题。

## 主要优化功能

### 1. 智能路径采样
- **自适应采样**: 根据路径复杂度动态调整采样密度
- **曲率感知**: 在曲率变化大的地方增加采样点，直线段减少采样
- **长度优化**: 基于路径总长度智能确定采样点数

### 2. 高级路径简化
- **道格拉斯-普克算法**: 优化的路径简化算法，保持形状精度的同时减少点数
- **批量处理**: 支持设置最大点数限制，超出时自动简化
- **容差配置**: 可调节的简化容差，平衡精度和性能

### 3. 性能配置系统
- **实时配置**: 可在运行时调整性能参数
- **预设模式**: 提供高质量、平衡、高性能三种预设
- **参数说明**:
  - `maxPointsPerPath`: 每个路径最大点数 (50-2000)
  - `simplificationTolerance`: 路径简化容差 (0.5-5.0)
  - `batchSize`: 批处理大小 (10-200)
  - `enableLOD`: 启用细节层次优化
  - `maxTotalPoints`: 总点数限制 (1000-20000)

### 4. 细节层次 (LOD) 系统
- **缩放感知**: 根据视图缩放级别自动调整显示精度
- **动态简化**: 缩小时自动减少显示点数，放大时恢复细节
- **内存优化**: 避免在不需要时渲染过多细节

### 5. 性能监控
- **实时统计**: 显示对象数、总点数、渲染时间等
- **FPS监控**: 实时帧率监控
- **内存使用**: 显示JavaScript堆内存使用情况
- **性能建议**: 根据当前负载提供优化建议

### 6. 分帧处理
- **非阻塞导入**: 使用 `requestAnimationFrame` 分帧处理大文件
- **进度显示**: 实时显示导入进度和状态
- **UI响应**: 保持界面响应性，避免长时间阻塞

## 使用方法

### 访问性能配置
1. 点击工具栏中的"性能"按钮
2. 选择预设配置或自定义参数
3. 点击"保存"应用设置

### 查看性能监控
1. 点击右上角的"性能监控"按钮
2. 查看实时性能数据
3. 根据建议调整配置

### 导入大型矢量文件
1. 建议先设置为"高性能"模式
2. 导入文件时观察进度和状态
3. 导入完成后可根据需要调整为"平衡"或"高质量"模式

## 性能建议

### 针对不同场景的推荐设置

#### 高质量预览 (适合最终输出)
- 最大点数: 1000
- 简化容差: 1.0
- 启用LOD: 是

#### 平衡模式 (日常使用)
- 最大点数: 500
- 简化容差: 2.0
- 启用LOD: 是

#### 高性能模式 (大文件/低配设备)
- 最大点数: 200
- 简化容差: 3.0
- 启用LOD: 是

### 优化技巧

1. **大文件处理**:
   - 先用高性能模式导入
   - 完成后切换到平衡模式编辑
   - 最终输出时使用高质量模式

2. **内存管理**:
   - 定期检查性能监控
   - 总点数超过10000时考虑简化
   - 启用LOD减少渲染负担

3. **设备适配**:
   - 低配设备: 降低最大点数和总点数限制
   - 高配设备: 可以提高精度设置
   - 移动设备: 建议启用LOD和较小的批处理大小

## 技术实现

### 核心算法
- **道格拉斯-普克简化**: 递归线段简化算法
- **智能采样**: 基于曲率变化的自适应采样
- **LOD渲染**: 基于视图缩放的动态细节调整

### 性能优化策略
- **内存池**: 复用对象减少GC压力
- **批处理**: 分批处理避免长时间阻塞
- **缓存机制**: 缓存变换矩阵和计算结果
- **懒加载**: 按需加载和渲染细节

### 兼容性
- 支持SVG、DXF、PLT格式
- 兼容现有的G代码生成流程
- 保持原有功能的完整性

## 故障排除

### 常见问题

1. **导入很慢**:
   - 检查文件大小和复杂度
   - 降低最大点数设置
   - 启用高性能模式

2. **显示不够精细**:
   - 提高最大点数设置
   - 降低简化容差
   - 检查LOD设置

3. **内存使用过高**:
   - 降低总点数限制
   - 启用更激进的简化
   - 定期清理不需要的对象

4. **界面卡顿**:
   - 减小批处理大小
   - 启用LOD
   - 检查FPS监控

### 调试工具
- 性能监控面板提供详细的运行时信息
- 浏览器开发者工具可查看详细的性能分析
- 控制台输出包含详细的处理日志

## 更新日志

### v1.0.0
- 实现智能路径采样
- 添加性能配置系统
- 集成LOD渲染
- 添加性能监控面板
- 优化分帧处理机制
