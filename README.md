# 白板图层逻辑修改说明

## 修改概述

本次修改实现了灵活的图层管理功能，允许用户添加和管理图层，但确保位图只能使用扫描图层。图层属性在创建时决定且之后不可修改。

## 主要修改内容

### 1. 灵活的图层管理
- 允许用户添加、删除、移动图层
- 新增图层时必须选择图层属性（扫描/雕刻）
- 图层属性在创建后不可修改
- 图层顺序可以自由调整

### 2. 智能对象分配
- **矢量对象**（形状、零件、涂鸦、文本）默认分配到雕刻图层
- **位图对象**（图片）只能使用扫描图层
- 矢量对象可以灵活分配到雕刻或扫描图层
- 位图对象严格限制只能使用扫描图层

### 3. 图层管理界面
- 恢复了添加、删除、移动图层功能
- 图层属性显示为只读标签
- 添加图层时弹出选择对话框

### 4. 属性编辑器
- 图层选择下拉框显示图层类型（扫描/雕刻）
- 添加提示信息说明对象的分配规则
- 阻止位图对象移动到雕刻图层
- 提示图层属性不可修改

## 对象类型分类

### 矢量对象（默认雕刻图层，可灵活分配）
- 所有基础形状：矩形、圆形、直线、多段线、圆弧、扇形、三角形等
- 所有零件库：L型支架、U型槽、法兰、圆环、带孔圆板等
- 涂鸦线条（DRAWING）
- 文本对象（TEXT）
- 组合对象（GROUP）

### 位图对象（严格限制扫描图层）
- 图片对象（IMAGE）

## 技术实现

### 核心函数
- `getPrintingMethodByItemType()`: 根据对象类型确定默认图层类型
- `getLayerIdByType()`: 获取指定类型的图层ID，必要时自动创建
- `addItem()`: 添加对象时自动分配到合适的图层
- `updateItem()`: 更新对象时验证图层类型匹配

### 验证逻辑
- 位图对象只能移动到扫描图层
- 矢量对象可以移动到雕刻或扫描图层
- 图层属性在创建后不可修改
- 在属性编辑器中提供用户友好的提示信息

## 用户体验

1. **灵活管理**: 用户可以自由添加和管理图层
2. **智能分配**: 系统自动为对象分配合适的图层
3. **防止错误**: 阻止位图对象移动到雕刻图层
4. **清晰提示**: 界面明确显示图层类型和分配规则

## 图层管理规则

### 添加图层
- 点击"添加图层"按钮创建新图层
- 弹出选择对话框，包含下拉选择框：
  - 选择"扫描图层"：创建扫描类型图层
  - 选择"雕刻图层"：创建雕刻类型图层
- 图层命名规则：
  - 扫描图层：扫描图层 1、扫描图层 2...
  - 雕刻图层：雕刻图层 1、雕刻图层 2...
- 图层属性在创建后不可修改

### 对象图层选择
- **矢量对象**：可以选择任何图层（雕刻或扫描）
- **位图对象**：图层选择下拉框只显示扫描图层选项
- 系统自动过滤不兼容的图层选项，防止误操作

### 删除图层
- 可以删除任何图层（除了最后一个）
- 删除图层时，该图层上的所有对象也会被删除

### 移动图层
- 可以上下移动图层调整顺序
- 图层顺序影响渲染和导出顺序

### 修改图层属性
- 可以修改图层名称和可见性
- **图层属性（扫描/雕刻）在创建后不可修改**
- 图层属性显示为只读标签

## 兼容性

- 现有项目会自动适应新的图层逻辑
- 矢量对象默认分配到雕刻图层
- 位图对象严格限制在扫描图层
- 导出功能保持不变，仍然按图层分别导出

## 移动端优化

### 触摸缩放优化
- **降低缩放灵敏度**：缩放灵敏度降低到20%，提供更精确的控制
- **添加防抖机制**：忽略小于5%的缩放变化，避免过于敏感的响应
- **改进缩放中心**：以触摸中心为缩放中心，提供更直观的缩放体验
- **修复缩放后平移**：修复缩放后平移操作的问题，确保平移距离与缩放比例匹配

### 触摸事件处理
- **单指触摸优化**：单指触摸时自动清除缩放状态，防止意外触发缩放
- **双指缩放**：只有双指触摸时才触发缩放操作
- **防止页面滚动**：缩放时禁止页面滚动，确保操作流畅

### 用户体验改进
- **更稳定的缩放**：减少缩放时的抖动和不稳定
- **更精确的控制**：用户可以更精确地控制缩放级别
- **更好的响应性**：缩放和平移操作更加流畅和响应 